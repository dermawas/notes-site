<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FlowformLab CMS</title>
    <meta name="robots" content="noindex" />

    <!-- OAuth postMessage shim: persist token for all key variants -->
    <script>
      (function () {
        var OAUTH_ORIGIN = "https://ffl-oauth.vercel.app";

        function onMessage(e) {
          if (e.origin !== OAUTH_ORIGIN) return;
          if (typeof e.data !== "string") return;

          var prefix = "authorization:github:success:";
          if (!e.data.startsWith(prefix)) return;

          var token = e.data.slice(prefix.length).trim();
          var payload = JSON.stringify({ token: token, provider: "github" });

          try {
            // Underscore keys
            localStorage.setItem("decap-cms-user", payload);
            localStorage.setItem("netlify-cms-user", payload);
            // Dot keys (some Decap builds expect these)
            localStorage.setItem("decap-cms.user", payload);
            localStorage.setItem("netlify-cms.user", payload);
          } catch (err) {
            console.error("Failed to persist OAuth token", err);
          }

          location.reload();
        }

        window.addEventListener("message", onMessage, false);
      })();
    </script>
  </head>
  <body>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  </body>
</html>
